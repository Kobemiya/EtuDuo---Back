---
openapi: 3.0.1
info:
  title: API V1
  version: v1
paths:
  "/accessories":
    get:
      summary: list accessories
      tags:
      - Accessories
      description: List all accessories in the game
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/accessory"
        '401':
          description: Unauthorized
    post:
      summary: create accessory
      tags:
      - Accessories
      description: Create a new accessory (needs perms)
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/accessory"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '409':
          description: Accessory already exists
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              allOf:
              - "$ref": "#/components/propertiesSchemas/accessoryProperties"
              required:
              - name
              - image_path
              - body_part
        description: Accessory infos
  "/accessories/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: integer
    get:
      summary: show accessory
      tags:
      - Accessories
      description: Get infos on a specified accessory
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/accessory"
        '401':
          description: Unauthorized
        '404':
          description: Not found
    patch:
      summary: update accessory
      tags:
      - Accessories
      description: Update infos of a specified accessory (needs perms)
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/accessory"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/propertiesSchemas/accessoryProperties"
        description: Accessory infos
    put:
      summary: update accessory
      tags:
      - Accessories
      description: Update infos of a specified accessory (needs perms)
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/accessory"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/propertiesSchemas/accessoryProperties"
        description: Accessory infos
    delete:
      summary: delete accessory
      tags:
      - Accessories
      description: Delete a specified accessory (needs perms)
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found
  "/inventory":
    get:
      summary: Show inventory
      tags:
      - Inventory
      description: Display the user's inventory, which contains the accessories obtained
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/accessory"
        '401':
          description: Unauthorized
  "/inventory/{accessory_id}":
    parameters:
    - name: accessory_id
      in: path
      description: accessory_id
      required: true
      schema:
        type: string
    put:
      summary: Add accessory in inventory
      tags:
      - Inventory
      description: Add a specified accessory in the user's inventory
      responses:
        '204':
          description: Added
        '401':
          description: Unauthorized
        '404':
          description: Not found
        '409':
          description: Conflict
    delete:
      summary: Remove accessory from inventory
      tags:
      - Inventory
      description: Remove a specified accessory from the user's inventory
      responses:
        '204':
          description: Removed
        '401':
          description: Unauthorized
        '404':
          description: Not found
        '409':
          description: Conflict
  "/profile":
    get:
      summary: Show profile
      tags:
      - Profile
      description: Show user's current profile informations
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/profile"
        '401':
          description: Unauthorized
    put:
      summary: Update profile
      tags:
      - Profile
      description: Update or create the user's profile
      parameters: []
      responses:
        '204':
          description: Created or Updated
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              allOf:
              - "$ref": "#/components/propertiesSchemas/profileProperties"
              required:
              - occupation
              - prod_period
              - start_work
              - end_work
        description: Profile infos
  "/tasks/tags":
    get:
      summary: List tags
      tags:
      - Tasks tags
      description: List all tasks tags user has access to
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/tag"
        '401':
          description: Unauthorized
    post:
      summary: Create tag
      tags:
      - Tasks tags
      description: Create a tag for the tasks
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/tag"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              allOf:
              - "$ref": "#/components/propertiesSchemas/tagProperties"
              required:
              - name
              - color
        description: Tag infos
  "/tasks/tags/global":
    post:
      summary: Create global tag
      tags:
      - Tasks tags
      description: Create a global tag for the tasks, needs appropriate permissions
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/tag"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              allOf:
              - "$ref": "#/components/propertiesSchemas/tagProperties"
              required:
              - name
              - color
        description: Tag infos
  "/tasks/tags/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: string
    get:
      summary: Show tag
      tags:
      - Tasks tags
      description: Show a specifid tag infos
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/tag"
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
    patch:
      summary: Update tag
      tags:
      - Tasks tags
      description: Update a tag's infos
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/tag"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/propertiesSchemas/tagProperties"
        description: Tag infos
    put:
      summary: Update tag
      tags:
      - Tasks tags
      description: Update a tag's infos
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/tag"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/propertiesSchemas/tagProperties"
        description: Tag infos
    delete:
      summary: Delete tag
      tags:
      - Tasks tags
      description: Delete the tag with the provided id
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
  "/tasks":
    get:
      summary: list tasks
      tags:
      - Tasks
      description: List all tasks the user has access to
      parameters:
      - name: date
        in: query
        type: string
        description: Permit to ask for the tasks for a specific date
        schema:
          type: string
          format: date-time
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/task"
        '401':
          description: Unauthorized
    post:
      summary: create task
      tags:
      - Tasks
      description: Creates a task with the provided infos
      parameters: []
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/task"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              allOf:
              - "$ref": "#/components/propertiesSchemas/taskProperties"
              required:
              - title
              - description
              - done
        description: Task infos
  "/tasks/{id}":
    parameters:
    - name: id
      in: path
      description: DB object id
      required: true
      schema:
        type: integer
    get:
      summary: show task
      tags:
      - Tasks
      description: Get the task with the provided id
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/task"
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
    delete:
      summary: delete task
      tags:
      - Tasks
      description: Delete the task with the providede id
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
    patch:
      summary: update task
      tags:
      - Tasks
      description: Update the task with the providede id
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/task"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/propertiesSchemas/taskProperties"
        description: Task infos
    put:
      summary: update task
      tags:
      - Tasks
      description: Update the task with the providede id
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/task"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/propertiesSchemas/taskProperties"
        description: Task infos
  "/user":
    get:
      summary: User infos
      tags:
      - User
      description: Fetch the user's informations stored in the DB
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/user"
        '401':
          description: Unauthorized
    post:
      summary: User creation
      tags:
      - User
      description: Create a user in DB to sync with Auth0 user
      parameters: []
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/user"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '409':
          description: User already exists
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              allOf:
              - "$ref": "#/components/propertiesSchemas/userProperties"
              required:
              - username
        description: Create with user infos
    delete:
      summary: User deletion
      tags:
      - User
      description: Delete the user in DB to desync with Auth0 user
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
    put:
      summary: User update
      tags:
      - User
      description: Update the user's infos in DB
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/user"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/propertiesSchemas/userProperties"
        description: Update with user infos
    patch:
      summary: User update
      tags:
      - User
      description: Update the user's infos in DB
      parameters: []
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/user"
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              "$ref": "#/components/propertiesSchemas/userProperties"
        description: Update with user infos
components:
  securitySchemes:
    BearerToken:
      description: Auth0 bearer token
      scheme: bearer
      type: apiKey
      name: Authorization
      in: header
  schemas:
    user:
      allOf:
      - "$ref": "#/components/idSchemas/withAuth0Id"
      - "$ref": "#/components/propertiesSchemas/userProperties"
      required:
      - auth0Id
      - username
    task:
      allOf:
      - "$ref": "#/components/idSchemas/withId"
      - "$ref": "#/components/propertiesSchemas/taskProperties"
      required:
      - id
      - title
      - description
      - done
      - start
      - end
    profile:
      allOf:
      - "$ref": "#/components/idSchemas/withId"
      - "$ref": "#/components/propertiesSchemas/profileProperties"
      required:
      - id
      - occupation
      - prod_period
      - start_work
      - end_work
      - start_sleep
      - end_sleep
    tag:
      allOf:
      - "$ref": "#/components/idSchemas/withId"
      - "$ref": "#/components/propertiesSchemas/tagProperties"
      - "$ref": "#/components/additionalPropertiesSchemas/tagGlobalProperty"
      required:
      - id
      - name
      - color
      - global
    accessory:
      allOf:
      - "$ref": "#/components/idSchemas/withId"
      - "$ref": "#/components/propertiesSchemas/accessoryProperties"
      required:
      - id
      - name
      - image_path
      - body_part
  idSchemas:
    withAuth0Id:
      type: object
      properties:
        auth0Id:
          type: string
    withId:
      type: object
      properties:
        id:
          type: integer
  propertiesSchemas:
    userProperties:
      type: object
      properties:
        username:
          type: string
    taskProperties:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        done:
          type: boolean
        recurrence:
          anyOf:
          - type: array
            items:
              type: string
              enum:
              - monday
              - tuesday
              - wednesday
              - thursday
              - friday
              - saturday
          - type: string
            pattern: yearly
          nullable: true
        tags:
          type: array
          items:
            type: integer
        unmovable:
          type: boolean
        start:
          type: string
          format: date-time
          nullable: true
        end:
          type: string
          format: date-time
          nullable: true
    profileProperties:
      type: object
      properties:
        occupation:
          type: string
          enum:
          - school
          - college
          - work
          - free
        prod_period:
          type: string
          enum:
          - before
          - after
          - both
        start_work:
          type: string
          format: date-time
        end_work:
          type: string
          format: date-time
        start_sleep:
          type: string
          format: date-time
          nullable: true
        end_sleep:
          type: string
          format: date-time
          nullable: true
    tagProperties:
      type: object
      properties:
        name:
          type: string
        color:
          type: string
          pattern: "#[A-Fa-f0-9]{6}"
    accessoryProperties:
      type: object
      properties:
        name:
          type: string
        image_path:
          type: string
          pattern: "(/[a-z0-9_])+"
        body_part:
          type: string
          enum:
          - hair
          - hand
          - face
          - neck
          - torso
          - legs
          - feet
  additionalPropertiesSchemas:
    tagGlobalProperty:
      type: object
      properties:
        global:
          type: boolean
security:
- BearerToken: []
servers:
- url: http://localhost:3000
- url: https://etuduo-backend.herokuapp.com/
